

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HamGNN_v_2_0.input.config_parsing &mdash; HamGNN 2.0 文档</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=8ba3eb92"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/translations.js?v=beaddf03"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            HamGNN
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航菜单">
              <p class="caption" role="heading"><span class="caption-text">API 文档</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../source/main_entry.html">主程序入口</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/model_structure.html">模型顶层结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/gnn_core.html">GNN 核心层</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/model_components.html">模型通用组件</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/data_processing.html">数据处理与输入</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../source/utilities.html">通用工具函数</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="移动版导航菜单" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">HamGNN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="页面导航">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">模块代码</a></li>
      <li class="breadcrumb-item active">HamGNN_v_2_0.input.config_parsing</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>HamGNN_v_2_0.input.config_parsing 源代码</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">/*</span>
<span class="sd"> * @Author: Yang Zhong </span>
<span class="sd"> * @Date: 2021-10-29 15:03:46 </span>
<span class="sd"> * @Last Modified by: Yang Zhong</span>
<span class="sd"> * @Last Modified time: 2021-10-29 16:45:04</span>
<span class="sd"> */</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&quot;&quot;&quot;该模块负责处理项目的配置信息。</span>

<span class="sd">它定义了所有参数的默认值，并提供了一个 `read_config` 函数，该函数能够：</span>
<span class="sd">1. 从一个指定的 YAML 文件中加载用户配置。</span>
<span class="sd">2. 将用户配置与预设的默认配置进行合并。</span>
<span class="sd">3. 将最终的配置转换为 `easydict.EasyDict` 对象，方便以属性方式访问。</span>
<span class="sd">4. 对损失函数和评估指标的配置进行预处理。</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">easydict</span><span class="w"> </span><span class="kn">import</span> <span class="n">EasyDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..models.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_activation</span><span class="p">,</span> <span class="n">parse_metric_func</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pprint</span>

<span class="c1"># ==============================================================================</span>
<span class="c1"># 默认配置参数</span>
<span class="c1"># ==============================================================================</span>
<span class="n">config_default</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># 训练设置 (setup)</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="n">config_default_setup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;GNN_Net&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Edge_GNN&#39;</span>  <span class="c1"># 使用的 GNN 网络名称</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;property&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;scalar_per_atom&#39;</span>  <span class="c1"># 要预测的属性类型</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;num_gpus&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># 使用的 GPU 数量</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;accelerator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># 加速器类型, e.g., &#39;dp&#39;, &#39;ddp&#39;, &#39;ddp_cpu&#39;</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># 训练精度 (16, 32, 64)</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;fit&#39;</span>  <span class="c1"># 当前阶段 (&#39;fit&#39;, &#39;test&#39;, &#39;predict&#39;)</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;resume&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否从上次的 checkpoint 断点续训</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;load_from_checkpoint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否从指定的 checkpoint 加载模型</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;checkpoint_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>  <span class="c1"># checkpoint 文件路径</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;ignore_warnings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否忽略警告信息</span>
<span class="n">config_default_setup</span><span class="p">[</span><span class="s1">&#39;l_minus_mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否在计算损失前减去目标均值</span>
<span class="n">config_default</span><span class="p">[</span><span class="s1">&#39;setup&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_setup</span>

<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># 数据集参数 (dataset_params)</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="n">config_default_dataset</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;database_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;db&#39;</span>  <span class="c1"># 数据源类型 (&#39;db&#39; 或 &#39;csv&#39;)</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;train_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.6</span>  <span class="c1"># 训练集比例</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;val_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># 验证集比例</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;test_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># 测试集比例</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># 批处理大小</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;split_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># 数据集划分索引文件的路径</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">6.0</span>  <span class="c1"># 构建图时近邻的截断半径</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;max_num_nbr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># 每个原子的最大近邻数</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;graph_data_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./graph_data&#39;</span>  <span class="c1"># 预处理图数据的保存路径</span>

<span class="c1"># --- 数据库类型为 &#39;db&#39; 时的参数 ---</span>
<span class="n">config_default_db_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">config_default_db_params</span><span class="p">[</span><span class="s1">&#39;db_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>  <span class="c1"># 数据库文件路径</span>
<span class="n">config_default_db_params</span><span class="p">[</span><span class="s1">&#39;property_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span><span class="s1">&#39;hamiltonian&#39;</span><span class="p">]</span>  <span class="c1"># 需要从数据库中提取的属性列表</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;db_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_db_params</span>

<span class="c1"># --- 数据库类型为 &#39;csv&#39; 时的参数 ---</span>
<span class="n">config_default_csv_params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">config_default_csv_params</span><span class="p">[</span><span class="s1">&#39;crystal_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;crystals&#39;</span>  <span class="c1"># 晶体结构文件所在目录</span>
<span class="n">config_default_csv_params</span><span class="p">[</span><span class="s1">&#39;file_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;poscar&#39;</span>  <span class="c1"># 晶体文件类型 (&#39;poscar&#39;, &#39;cif&#39;)</span>
<span class="n">config_default_csv_params</span><span class="p">[</span><span class="s1">&#39;id_prop_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>  <span class="c1"># id_prop.csv 文件所在目录</span>
<span class="n">config_default_csv_params</span><span class="p">[</span><span class="s1">&#39;rank_tensor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 预测张量的阶数</span>
<span class="n">config_default_csv_params</span><span class="p">[</span><span class="s1">&#39;l_pred_atomwise_tensor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># 是否预测原子级别的张量</span>
<span class="n">config_default_csv_params</span><span class="p">[</span><span class="s1">&#39;l_pred_crystal_tensor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否预测晶体级别的张量</span>
<span class="n">config_default_dataset</span><span class="p">[</span><span class="s1">&#39;csv_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_csv_params</span>

<span class="n">config_default</span><span class="p">[</span><span class="s1">&#39;dataset_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_dataset</span>

<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># 优化器参数 (optim_params)</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="n">config_default_optimizer</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">config_default_optimizer</span><span class="p">[</span><span class="s1">&#39;lr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># 初始学习率</span>
<span class="n">config_default_optimizer</span><span class="p">[</span><span class="s1">&#39;lr_decay&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># 学习率衰减因子</span>
<span class="n">config_default_optimizer</span><span class="p">[</span><span class="s1">&#39;lr_patience&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># 学习率衰减的等待轮数</span>
<span class="n">config_default_optimizer</span><span class="p">[</span><span class="s1">&#39;gradient_clip_val&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># 梯度裁剪阈值 (0表示不裁剪)</span>
<span class="n">config_default_optimizer</span><span class="p">[</span><span class="s1">&#39;stop_patience&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># 早停的等待轮数</span>
<span class="n">config_default_optimizer</span><span class="p">[</span><span class="s1">&#39;min_epochs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># 最小训练轮数</span>
<span class="n">config_default_optimizer</span><span class="p">[</span><span class="s1">&#39;max_epochs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># 最大训练轮数</span>
<span class="n">config_default</span><span class="p">[</span><span class="s1">&#39;optim_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_optimizer</span>

<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># 损失与评估指标 (losses_metrics)</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="n">config_default_metric</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">config_default_metric</span><span class="p">[</span><span class="s1">&#39;losses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;mse&#39;</span><span class="p">,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span>  <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;loss_weight&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span> <span class="p">{</span>
    <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;cosine_similarity&#39;</span><span class="p">,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span>  <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span> <span class="s1">&#39;loss_weight&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}]</span>
<span class="n">config_default_metric</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;mae&#39;</span><span class="p">,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span>  <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s1">&#39;energy&#39;</span><span class="p">},</span> <span class="p">{</span>
    <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="s1">&#39;cosine_similarity&#39;</span><span class="p">,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">:</span> <span class="s1">&#39;energy&#39;</span><span class="p">,</span>  <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="s1">&#39;energy&#39;</span><span class="p">}]</span>
<span class="n">config_default</span><span class="p">[</span><span class="s1">&#39;losses_metrics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_metric</span>

<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># 性能分析器参数 (profiler_params)</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="n">config_default_profiler</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">config_default_profiler</span><span class="p">[</span><span class="s1">&#39;train_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;train_data&#39;</span>  <span class="c1"># 训练日志和输出的保存目录</span>
<span class="n">config_default_profiler</span><span class="p">[</span><span class="s1">&#39;progress_bar_refresh_rat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 进度条刷新频率</span>
<span class="n">config_default</span><span class="p">[</span><span class="s1">&#39;profiler_params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_profiler</span>

<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># 表示层网络 (representation_nets)</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="n">config_default_representation_nets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="c1"># 此处可添加表示层网络的默认参数</span>
<span class="n">config_default</span><span class="p">[</span><span class="s1">&#39;representation_nets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_representation_nets</span>

<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="c1"># 输出层网络 (output_nets)</span>
<span class="c1"># ------------------------------------------------------------------------------</span>
<span class="n">config_default_output_nets</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">config_default_output_nets</span><span class="p">[</span><span class="s1">&#39;output_module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;HamGNN_out&#39;</span>  <span class="c1"># 使用的输出模块名称</span>

<span class="c1"># --- HamGNN 输出模块 (HamGNN_out) 的特定参数 ---</span>
<span class="n">config_default_HamGNN_out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;nao_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>  <span class="c1"># 最大原子轨道数</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;return_forces&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否计算并返回力</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;create_graph&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否在计算图中创建额外的边</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;ham_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;openmx&#39;</span>  <span class="c1"># 哈密顿量类型</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;ham_only&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># 是否只输出哈密顿量</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;irreps_in_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># 节点输入的不可约表示</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;irreps_in_edge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># 边输入的不可约表示</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;irreps_in_triplet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># 三元组输入的不可约表示</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;include_triplet&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否包含三元组信息</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;symmetrize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># 是否对哈密顿量进行对称化处理</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;calculate_band_energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># 是否计算能带能量</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;num_k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># k点数量</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;soc_switch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否开启自旋轨道耦合(SOC)</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;nonlinearity_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gate&#39;</span>  <span class="c1"># 非线性激活函数类型</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;band_num_control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>  <span class="c1"># 能带数量控制</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;k_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># k点路径</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;spin_constrained&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否进行自旋约束</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;collinear_spin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># 是否为共线自旋计算</span>
<span class="n">config_default_HamGNN_out</span><span class="p">[</span><span class="s1">&#39;minMagneticMoment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># 最小磁矩</span>
<span class="n">config_default_output_nets</span><span class="p">[</span><span class="s1">&#39;HamGNN_out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_HamGNN_out</span>

<span class="n">config_default</span><span class="p">[</span><span class="s1">&#39;output_nets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_default_output_nets</span>


<div class="viewcode-block" id="read_config">
<a class="viewcode-back" href="../../../source/data_processing.html#HamGNN_v_2_0.input.config_parsing.read_config">[文档]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_config</span><span class="p">(</span><span class="n">config_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;config_default.yaml&#39;</span><span class="p">,</span> <span class="n">config_default</span><span class="o">=</span><span class="n">config_default</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;从 YAML 文件读取配置，并与默认配置合并。</span>

<span class="sd">    Args:</span>
<span class="sd">        config_file_name (str, optional): </span>
<span class="sd">            用户指定的配置文件路径。默认为 &#39;config_default.yaml&#39;。</span>
<span class="sd">        config_default (dict, optional): </span>
<span class="sd">            包含所有默认参数的字典。默认为本模块中定义的 `config_default`。</span>

<span class="sd">    Returns:</span>
<span class="sd">        easydict.EasyDict: </span>
<span class="sd">            一个 EasyDict 对象，包含了合并后的最终配置，可以通过属性点号 `.`</span>
<span class="sd">            方便地访问各级配置项。</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file_name</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">rstream</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">rstream</span><span class="p">,</span> <span class="n">yaml</span><span class="o">.</span><span class="n">SafeLoader</span><span class="p">)</span>
    <span class="c1"># 遍历从文件中加载的顶层键（如 &#39;setup&#39;, &#39;dataset_params&#39;）</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="c1"># 用文件中的配置更新对应的默认配置字典</span>
        <span class="n">config_default</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    
    <span class="c1"># 将最终的字典转换为 EasyDict 对象</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">EasyDict</span><span class="p">(</span><span class="n">config_default</span><span class="p">)</span>
    
    <span class="c1"># 对损失和指标函数进行特殊解析，将其从字符串转换为实际的函数对象</span>
    <span class="n">config</span><span class="o">.</span><span class="n">losses_metrics</span><span class="o">.</span><span class="n">losses</span> <span class="o">=</span> <span class="n">parse_metric_func</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">losses_metrics</span><span class="o">.</span><span class="n">losses</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">losses_metrics</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">parse_metric_func</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">losses_metrics</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">config</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; 版权所有 2025, HamGNN Team。</p>
  </div>

  利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用的 
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    由 <a href="https://readthedocs.org">Read the Docs</a> 开发.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>